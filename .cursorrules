# Cursor Rules for Instagram Reels Auto-Generator

## 프로젝트 개요
인스타그램 릴스 자동 생성 프로그램 - 키워드 기반 콘텐츠 및 영상 자동 제작

## ⚠️ 최우선 준수 사항 (CRITICAL RULES)

### 1. 기획서 및 문서 참고 필수
- **코딩하기 전 반드시 다음 문서들을 참고할 것**:
  - `상위기획서.md`: 프로젝트 전체 개요 및 기술 스택
  - `PRD.md`: 제품 요구사항 명세서 (기능 정의)
  - `기술명세서.md`: 시스템 아키텍처 및 구현 방법
  - `API명세서.md`: API 엔드포인트 설계
  - `.cursorrules`: 이 파일 (코딩 규칙)
- 새로운 기능 구현 시 해당 문서의 설계를 따를 것
- 문서와 충돌되는 구현은 사용자에게 먼저 확인받을 것

### 2. 범위 제한 (Scope Limitation)
- **사용자가 명시적으로 요청한 기능만 구현할 것**
- 허락 없이 다른 기능의 코드를 수정하거나 변경하지 말 것
- 의존성이 있는 다른 모듈 수정이 필요한 경우 사용자에게 먼저 물어볼 것
- "좋을 것 같아서" 추가 기능을 임의로 구현하지 말 것
- 리팩토링이나 최적화도 요청받았을 때만 수행할 것

### 3. 배포 및 테스트 규칙
- **절대로 임의로 배포(deploy, push to production)하지 말 것**
- 모든 코드는 로컬 환경에서 충분히 테스트 후 커밋할 것
- 테스트 필수 항목:
  - [ ] 유닛 테스트 통과 (`pytest`)
  - [ ] 린트 체크 통과 (`flake8`, `black --check`)
  - [ ] 타입 체크 통과 (`mypy`)
  - [ ] 로컬에서 실제 동작 확인
- 테스트 없이 커밋하지 말 것
- 배포는 사용자가 직접 결정하고 실행함

### 4. 변경사항 명확히 설명
- 코드 작성 후 무엇을 변경했는지 명확히 설명할 것
- 새로 추가된 파일, 수정된 파일 목록 제시
- 실행 방법 및 테스트 방법 안내
- 의존성 추가 시 이유 설명

## 언어 설정
- **항상 한국어로만 대답하고 코드 주석도 한국어로 작성할 것**
- 모든 문서, 커밋 메시지, PR 설명도 한국어로 작성
- 변수명과 함수명은 영어 사용 가능하지만, docstring은 한국어로

## 코드 스타일 및 컨벤션

### Python
- PEP 8 스타일 가이드 준수
- 타입 힌팅 필수 사용 (Python 3.10+)
- docstring은 Google 스타일로 작성 (한국어)
- 함수는 단일 책임 원칙 준수
- 비동기 처리는 asyncio 사용
- 에러 처리는 명시적으로 (try-except)

```python
# 좋은 예시
async def generate_script(keyword: str, length: int = 30) -> dict[str, Any]:
    """
    키워드를 기반으로 릴스 대본을 생성합니다.
    
    Args:
        keyword: 검색 키워드
        length: 영상 길이 (초 단위)
        
    Returns:
        생성된 대본 정보를 담은 딕셔너리
        
    Raises:
        ValueError: 키워드가 비어있는 경우
        APIError: GPT API 호출 실패 시
    """
    if not keyword:
        raise ValueError("키워드는 필수입니다")
    
    # 구현...
```

### 파일 구조
```
macro/
├── src/
│   ├── content/          # 콘텐츠 수집 모듈
│   ├── media/            # 미디어 처리 모듈
│   ├── video/            # 영상 생성 모듈
│   ├── api/              # 외부 API 연동
│   └── utils/            # 유틸리티 함수
├── tests/                # 테스트 코드
├── config/               # 설정 파일
├── docs/                 # 문서
└── scripts/              # 스크립트
```

## API 및 외부 서비스 사용

### 필수 환경 변수
```bash
OPENAI_API_KEY=         # GPT API 키
UNSPLASH_ACCESS_KEY=    # Unsplash API 키
PEXELS_API_KEY=         # Pexels API 키
ELEVENLABS_API_KEY=     # TTS API 키
```

### API 호출 규칙
- 모든 API 호출은 retry 로직 포함 (최대 3회)
- Rate limiting 고려한 요청 관리
- 환경 변수로 API 키 관리 (절대 하드코딩 금지)
- API 응답은 항상 검증 후 사용
- timeout 설정 필수 (기본 30초)

## 데이터 처리

### 파일 저장 규칙
- 임시 파일은 `temp/` 디렉토리에 저장
- 생성된 영상은 `output/` 디렉토리에 저장
- 파일명 형식: `{timestamp}_{keyword}_{unique_id}.mp4`
- 처리 완료 후 임시 파일은 반드시 삭제

### 이미지/영상 처리
- 이미지 최대 해상도: 1920x1080
- 영상 출력 포맷: MP4 (H.264, AAC)
- 릴스 해상도: 1080x1920 (9:16)
- 프레임레이트: 30fps 고정

## 에러 처리 및 로깅

### 로깅 레벨
- DEBUG: 개발 단계 상세 로그
- INFO: 주요 프로세스 진행 상황
- WARNING: 경고 사항 (처리는 계속)
- ERROR: 에러 발생 (복구 시도)
- CRITICAL: 치명적 에러 (프로그램 중단)

### 커스텀 예외
```python
class ContentGenerationError(Exception):
    """콘텐츠 생성 중 발생하는 에러"""
    pass

class MediaDownloadError(Exception):
    """미디어 다운로드 중 발생하는 에러"""
    pass

class VideoRenderError(Exception):
    """영상 렌더링 중 발생하는 에러"""
    pass
```

## 테스트

### 테스트 커버리지
- 최소 80% 이상 유지
- 모든 API 연동 함수는 mock 테스트 작성
- 영상 생성 로직은 통합 테스트 필수

### 테스트 파일 구조
```python
# tests/test_content.py
import pytest
from src.content import ContentGenerator

@pytest.fixture
def content_generator():
    """ContentGenerator 인스턴스를 반환하는 fixture"""
    return ContentGenerator()

async def test_generate_script_success(content_generator):
    """대본 생성 성공 케이스"""
    result = await content_generator.generate_script("AI 트렌드")
    assert "script" in result
    assert len(result["script"]) > 0
```

## 성능 최적화

### 필수 고려사항
- 이미지 다운로드는 비동기 병렬 처리
- 영상 렌더링은 멀티프로세싱 사용
- 캐싱 전략 적용 (자주 사용되는 리소스)
- 메모리 사용량 모니터링 (큰 파일 처리 시)

### 렌더링 최적화
```python
# 병렬 처리 예시
from concurrent.futures import ProcessPoolExecutor

def render_video_optimized(scenes: list[Scene]) -> str:
    """
    멀티프로세싱을 활용한 영상 렌더링 최적화
    """
    with ProcessPoolExecutor(max_workers=4) as executor:
        # 병렬 처리 로직
        pass
```

## 보안 규칙

### 중요 사항
- API 키는 절대 코드에 포함하지 않음
- `.env` 파일은 `.gitignore`에 포함
- 사용자 입력은 항상 검증 및 sanitize
- SQL Injection, XSS 방지 처리
- 저작권 있는 콘텐츠 사용 금지

## Git 커밋 규칙

### 커밋 메시지 포맷
```
<타입>: <제목>

<본문>

<푸터>
```

### 타입
- `feat`: 새로운 기능 추가
- `fix`: 버그 수정
- `docs`: 문서 수정
- `style`: 코드 포맷팅
- `refactor`: 코드 리팩토링
- `test`: 테스트 코드
- `chore`: 빌드, 설정 변경

### 예시
```
feat: GPT-4를 활용한 대본 생성 기능 추가

- OpenAI API 연동 모듈 구현
- 키워드 기반 프롬프트 생성 로직 추가
- 대본 길이 조절 기능 구현

Closes #123
```

## AI 어시스턴트 규칙

### 응답 방식
- **모든 응답은 한국어로만 제공**
- 코드 설명 시 주석도 한국어로
- 기술 용어는 한글과 영어 병기 (예: "비동기(async)")
- 예제 코드는 실제 동작 가능한 코드로 제공
- 복잡한 로직은 단계별로 설명

### 코드 생성 시
- 타입 힌팅 필수 포함
- docstring 자동 생성 (한국어)
- 에러 처리 포함
- 테스트 코드도 함께 제안
- 성능 최적화 고려

### 디버깅 시
- 에러 메시지 한국어로 설명
- 원인 분석 제공
- 해결 방법 단계별 제시
- 예방 방법 제안

## 문서화

### 필수 문서
- README.md: 프로젝트 개요 및 설치 방법
- API.md: API 사용 가이드
- CONTRIBUTING.md: 기여 가이드
- CHANGELOG.md: 버전별 변경 사항

### 코드 문서화
- 모든 public 함수/클래스는 docstring 필수
- 복잡한 알고리즘은 주석으로 설명
- TODO, FIXME, HACK 태그 활용

## 의존성 관리

### 패키지 관리
- `requirements.txt`: 프로덕션 의존성
- `requirements-dev.txt`: 개발 의존성
- 버전은 명확하게 고정 (==)
- 정기적으로 보안 취약점 체크

### 핵심 라이브러리
```
openai>=1.0.0
moviepy>=1.0.3
pillow>=10.0.0
pydantic>=2.0.0
fastapi>=0.104.0
httpx>=0.25.0
pytest>=7.4.0
```

## 배포 및 운영

### 환경 분리
- development: 개발 환경
- staging: 스테이징 환경
- production: 프로덕션 환경

### 모니터링
- 영상 생성 성공률 추적
- API 응답 시간 모니터링
- 에러율 추적
- 리소스 사용량 모니터링

## 라이선스 및 저작권

### 주의사항
- 사용하는 모든 이미지/영상은 라이선스 확인
- API 이용 약관 준수
- 오픈소스 라이브러리 라이선스 준수
- 생성된 콘텐츠의 저작권 명시

---

이 규칙들은 프로젝트의 품질과 일관성을 유지하기 위한 기준입니다.
모든 기여자는 이 규칙을 숙지하고 따라야 합니다.

